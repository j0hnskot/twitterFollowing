// server.js

// set up ======================================================================
// get all the tools we need
var express  = require('express');
var app      = express();
var port     = process.env.PORT || 8080;
var testJSON = {ids:[2175840834,2181860676,2182969026,2185297358,2187279570,2189495714,2192019594,2193324134,2194307604,2194583562,2195935375,2196532267,2204915852,2213107189,2215063848,2217904600,2218559780,2218768699,2221191445,2221620960,2222249642,2228518196,2230485692,2231554573,2231592134,2241053310,2241656173,2246822635,2248014919
  ,2255341038,2258153880,2267984428,2268388122,2270126130,2274573408,2277869664,2283067068,2290583545,2291689147,
  2292823026,2293243392,2295010416,2301998851,2302116505,2304916086,2305627483,
  2310803407,2313025830,2313626342,2313875894,2313929515,2318602004,2318604018,2319344258,2321179921,2324765466,
  2326609070,2328772364,2332131326,2332530163,2333833272,2335548348,2341265540,2344353188,2347476584,2349415295,
  2349801090,2350970084,2351714589,2353138728,2353362138,2356062996,2358878593,2359855512,2362890450,2362950600,2363984658,2364936713
  ,2370136663,2370870518,2371148628,2372310654,2373691687,2374382166,2374872470,2375806412,2379660805,2380807502,2384029333,2388964022
  ,2391027907,2392908576,2400322530,2400689358,2411086628,2414545261,2415835232,2416247340,2417617518,2418375068,2422403311,2424037128
  ,2424472432,2427919704,2430114002,2436093974,2438419232,2438970236,2441266722,2443980007,2452701006,2456960154,2460456552,2461258015
  ,2464569536,2468239298,2468913308,2470879400,2478890238,2482743224,2482984783,2491848040,2493244664,2493460784,2493794370,2500307654
  ,2506037239,2507781188,2514756367,2518184528,2534680032,2537359397,2537627848,2538048114,2542202678,2544174218,2561621592,2563737422
  ,2569328622,2575234756,2577056605,2581465032,2583918505,2589228648,2595089167,2596127120,2597318154,2597603074,2597858845,2598992862,
  2600718234,2601875439,2610022508,2612897234,2613922315,2618081870,2646982201,2647307947,2661186775,2663045802,2675461386,2677267392
  ,2678644651,2685656083,2685706868,2687823037,2706628178,2710816976,2716444867,2716686193,2720101459,2726452104,2730451831,2731434809
  ,2737092556,2739417256,2742352728,2745774135,2746353536,2766324118,2776163882,2779503991,2785065085,15715860,167916196,1895110598,
  91279438,81184338,752673,88387348,2954522863,177400648,1961064799,2956855909,440907266,2840707906,122152338,555321719,6621222,99830548
  ,1186964713,80291429,2397892717,480302432,276553326,52053287,563621739,1102018903,12828802,334865819,2711770177,2213197608,817437266,753912228,378262332,45596891,292081301,132655198,772682964,262265666,190990880,2321541085,2194389944,2652859614,310368917,582467454,2168729130,274501532,85012424,396126368,20874976,344314794,56393254,41026911,2701232089,22401602,179160660,469563336,885929520,532465121,2561997186,331485952,338004760,2181166218,128343266,131395879,19035653,2704581690,2542640070,42921527,114113094,884830206,2790935251,618489603,295727858,24720774,17443473,539345368,622262193,801971814,456802802,23282663,2158202118,253770594,3026533863,
  158465486,155949717,459275531,81895035,14480184,246020195,270138816,2327867466,2163300301,286377221,219606488,17907265,40780444,1337349132,406525651,408379080,90996334,704274062,15400055,76397241,148534482,325600074,1499086092,85144671,780256,36155110,365951262,14815264,863395488,102327566,23704116,6542802,18093468,1270199574,89734835,627717867,16494321,76396190,2279396087,281145445,1391254838,435141615,22095887,581282631,44150150,99972221,102500579,19684844,21351966,176017872,1920390498,23626834,14433297,17004524,88529183,20764565,822644540,1684179816,21599965,169164432,841733204,2956584992,1442171222,15750540,2412937980,282742400,2459928867,512410920,2836451415,2571530882,2604001146,413898659
  ,1489703012,2341648986,2342615754,2177802744,
  1382654978,19276719,2385357091,2421437281,91942071,96308224,2996337657,3014889545,1453264381,1465765268,2291548094,630145817,118046102,438751517,335324807,2484306818,2511508146,522580809,532406707,46295685,3174029262,2290316700,1171406186,1525645638,2583818412,1478869458,2995340558,100893218,38247323,36832842,340804120,20501583,3016396300,2687457566,340084602,24636191,317871841,53689588,163535738,97486299,1141081634,2540958506,472132412,2369467405,3424681,251089224,40787074,588177790,974791759,1565678965,30472001,112874216,101906582,225477924,21273590,163619881,569458183,617423,409174363,167784607,479984327,16248319,133801192,25537232,816556332,610572399,477046079,2179358268,6075382,15484541,162611402,344196055,236543753,111369184,125992318,935341561,16953238,543305619,3091402414,422216482,3044801289,14078696,2510315702,201485901,2851865927,192269796,42332035,13461662,360964430,14538254,16792453,6284432,150248263,2325532627,1405071,5821972,5867722,14939776,17206070,18600956,19382657,20282537,23487429,24422716,29756727,33868543,38318973,40300483,42345318,54371309,63485337,70587360,73731253,74741682,74903868,77059348,96394264,107336879,115216851,155844378,157507895,176926051,206558728,211538203,241086349,256853298,257320593,467035507,485197487,545558899,780996614,793818756,1397181104,1564436942,2370711062,960921,6719092,10809702,13639462,13672952,14338704,14574940,15012103,15712419,15840592,15931117,16870557,17180679,17424360,19159746,19589015,19724394,19732328,19781217,21700751,27216200,29112695,30345872,30347306,30518499,41071248,43149870,44530504,44934830,45509153,47472277,50335088,54071173,57318109,58704686,63690235,65347016,68883800,71114116,77376531,84120496,86344883,86795688,90664252,92907153,108015974,110530831,115045834,116129586,120203531,122773269,124432352,126480837,127843079,131164030,154721803,155688134,175908904,204022164,211859595,225935776,233333868,234482705,239722164,243388780,250665191,257949300,259150981,260380928,263864687,266290561,269525310,286568044,288768326,290998589,296090854,298166798,312190122,316145842,323149972,327310994,327885150,328191068,340056002,340905725,353844407,376847815,387112059,393557750,401591317,404362452,412706791,463211955,484012196,484163973,488846781,502806070,556863651,562602850,575310831,588470636,607947753,614578567,630744873,631631601,635684113,746352631,761088222,885187243,887218327,893819318,915290959,964718448,975919248,989247980,1010203568,1015084878,1019876803,1048934948,1060895222,1069068799,1087504332,1119115682,1142318066,1143847608,1181264155,1236159252,1239395053,1247939708,1267566835,1377417127,1405335290,1410851173,1412193086,1427191898,1458030919,1459090969,1476777258,1487912180,1534576051,1558607754,1601322049,1604928848,1621092164,1631709926,1631946180,1640922529,1674044304,1678609320,1700392106,1721760860,1932135912,1943041442,1954903550,2167455536,2169160820,2203226940,2264894712,2291727272,2335768508,2350443889,2380191342,2409112183,2413000754,2436643548,2443241683,2454151701,2458165627,2494260060,2534491477,2547325406,2557373240,2566130976,2590344397,2668703832,2686355172,2723282522,2733338276,2737281272,2743413756,2744825012,2776918981,2783499800,2791021012,2800560631,2801227963,2842660019,2846580298,2856824889,2883005517,2888060028,2888943979,2905390312,2921973921,2946814236,2968868344,2969146418,2972306771,2984257186,2988080248,2990754641,2993842424,3002316963,3018279997,3035123576,3044639813,3059294465,3061997275,3064610660,2281760194,2284347316,2379200923,2394033708,2400218877,2427113725,2483992969,2797943656,2814446851,2831873030,2904009681,2905147157,2912992271,3022049179,3025119565,3059255581,370740145,2790244344,289417661,533685565,68791386,307642294,549803985,394973031,15134402,137144052,24107344,886882542,126278129,16671869,394483029,23636912,449230580,344093356,192749697,90379747,244746802,6957642,2414227124,17404184,1044020509,72393838,84273114,86901319,539530231,1547418816,352059616,2663748318,282328817,2725644713,403446518,130631164,317564714,155201220,3063947591,2893533885,1072742528,2800356308,128245681,443540893,1060988720,354311009,2974296911,3146113551,2798055612,2937495282,3116102361,3164478102,23134190,2235577028,2533312820,1329771756,33495086,8927762,24733117,26949885,28478793,34943702,35734366,36815980,49964679,50815971,62554155,72761871,77725938,80235953,82847820,97060074,102442385,116999724,130920525,136844568,138221532,141301490,160136282,232642391,97213472,2722537322,13339272,1634061696,17891217,288130941,432343978,1555896828,2231485591,460144206,25332451,22068522,42955897,2154515000,56676166,2378029861,252812155,3064009577,36345421,49110993,27269825,38464833,449872176,1735241,12879682,14634791,14808307,15076583,15274836,15299697,15506203,15977854,16150075,16294267,16814727,16915314,17387933,17447665,17983854,18318328,19316480,19533564,19664316,20050733,20651510,20391375,21836409,22694866,23378408,23389692,26564529,27095215,29231788,29459695,29927789,31096135,31407208,35767916,36008885,36032320,37188645,40212561,40826298,42300372,46801044,49319343,49860355,50551561,51678226,51918136,56712219,57779822,80464013,81418688,92415200,96782627,102363028,103957230,105660982,120707178,124232800,1573316437,961831392,2241040903,2726960366,2484845630,2568040687,3002690608,86369765,520759749,116989175,3174280240,2828584728,1545682794,2719996958,2486054191,3166098432,2213301077,3045425091,541379526,73942904,3078696530,22492293,84003074,110897594,303233865,327635417,348381426,348790110,382519825,464266551,475868209,510092703,561776609,581929409,724436360,724484611,813586646,819568826,1069461756,1094626782,1175721860,1354542846,1465232090,1678914463,1728304417,1961800232,2296570424,2350532462,2408145653,2557158574,2579315784,2591517416,
  2791962633,2823578594,2827627514,2956808520,2962450052,2973639580,15662622,2327827332,83274029,14208937,126401130,2564026262,34055923
  ,78121483,3541471,44350927,14866991,5871762,26050865,9442942,548708422,17386789,260387432,418562271,14501881,420308202,288870262,
  14846662,16014198,53026673,479884445,3097328992,410405568,83323138,1555649875,166458668,15290915,5529522,122790658,177025064,
  288856076,334689830,391860757,569418080,611094050,622410118,769648663,806131051,952502046,1006251576,1015071589,1260640591
  ,1465518264,2253488473,2309329848
  ,2373848738,2377803456,2525291726,
  2527822254,2754685950,594925643,73508323,38515332,2781005310,32343393,3156310711,58641745,3147055937,2239538802]}
// var mongoose = require('mongoose');
// var passport = require('passport');
// var flash 	 = require('connect-flash');
var path     = require('path');
// var morgan       = require('morgan');
var cookieParser = require('cookie-parser');
var bodyParser   = require('body-parser');
var session      = require('express-session');


var OAuth = require('OAuth');

var oauth = new OAuth.OAuth(
      'https://api.twitter.com/oauth/request_token',
      'https://api.twitter.com/oauth/access_token',
      'eHsp5kt8majGEycA5RbCFTAj2',
      'VT1CNzy45yesyIHoX2lhVbDod1Cu47u4SF2lJ9UYGW2FqJUXrs',
      '1.0A',
      null,
      'HMAC-SHA1'
    );



{  // var configDB = require('./config/database.js');

  // configuration ===============================================================
  // mongoose.connect(configDB.url); // connect to our database
  // require('./app/models/article.js')
  //  require('./config/passport')(passport); // pass passport for configuration

  // // set up our express application
  // app.use(morgan('dev')); // log every request to the console

}


app.use(cookieParser()); // read cookies (needed for auth)
app.use(bodyParser()); // get information from html forms

app.set('view engine', 'ejs'); // set up ejs for templating
// required for passport
app.use(session({ secret: 'ilovescotchscotchyscotchscotch' })); // session secret


// app.use(flash()); // use connect-flash for flash messages stored in session

// routes ======================================================================

app.use(express.static(path.join(__dirname, 'public')));


app.get('/', function(req, res){

  // res.render('index', { user: req.user, "data": testJSON});

  oauth.get(
    'https://api.twitter.com/1.1/friendships/show.json?source_screen_name=j0hnskot&target_screen_name=Affiliate_10K',
    // 'https://api.twitter.com/1.1/users/show.json?user_id=2175840834',
    // 'https://api.twitter.com/1.1/friends/ids.json?count=5000',
    // 'https://api.twitter.com/1.1/followers/list.json',
    '169445321-CunyXhW5t2KmlYZMoiRHVuy1XcPohSFSPG770QYW',
    //you can get it at dev.twitter.com for your own apps
    '1lmBGEBv5ttmu4FUW6FtjELMsRYxmQOpzrNA21fZMoD4e',
    //you can get it at dev.twitter.com for your own apps

    function (e, data, oauthRes){
      if (e) console.error(e);
      console.log(require('util').inspect(data));
      res.render('index', { user: req.user, "data": JSON.parse(data)});

      // done();
    });
});

app.get('/account', function(req, res){
  res.render('account', { user: req.user });
});

app.get('/login', function(req, res){
  res.render('login', { user: req.user });
});



// launch ======================================================================
app.listen(port);
console.log('The magic happens on port ' + port);
